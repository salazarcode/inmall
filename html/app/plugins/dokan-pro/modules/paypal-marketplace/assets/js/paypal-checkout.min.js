!function(e,o,r){"use strict";if("undefined"!=typeof dokan_paypal&&dokan_paypal.is_checkout_page&&"smart"===dokan_paypal.payment_button_type){var a={selected_payment_method:"",loaded:!1,toggle_buttons:function(o){var r="dokan_paypal_marketplace"===o,a=r?"show":"hide",t=r?"hide":"show";e("#paypal-button-container").animate({opacity:a,height:a,padding:a},230),e("#place_order").animate({opacity:t,height:t,padding:t},230)},on_change:function(){e("form.checkout, form#order_review").on("click",'input[name="payment_method"]',(function(e){"smart"===dokan_paypal.payment_button_type&&a.selected_payment_method!==e.target.value&&(a.selected_payment_method=e.target.value,a.toggle_buttons(e.target.value))}))},init:function(){if(o.paypal&&!a.loaded){a.loaded=!0;var r=e(".woocommerce-checkout").find('input[name="payment_method"]:checked').val();a.toggle_buttons(r),a.on_change()}else a.loaded||setTimeout((function(){a.init()}),2e3)}},t={checkout_form:e("form.checkout, form#order_review"),order_success_redirect_url:"",order_cancel_redirect_url:"",order_id:"",loaded:!1,reset_order_data:function(){this.order_success_redirect_url="",this.order_cancel_redirect_url="",this.order_id=""},is_paypal_selected:function(){return"dokan_paypal_marketplace"===e(".woocommerce-checkout").find('input[name="payment_method"]:checked').val()},set_loading_on:function(){t.checkout_form.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},set_loading_done:function(){t.checkout_form.removeClass("processing").unblock()},submit_error:function(o){t.set_loading_done(),t.reset_order_data(),e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),t.checkout_form.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+o+"</div>"),t.checkout_form.find(".input-text, select, input:checkbox").trigger("validate").trigger("blur"),t.scroll_to_notice(),e(r.body).trigger("checkout_error",[o])},scroll_to_notice:function(){e("html, body").animate({scrollTop:e("form.checkout, form#order_review").offset().top-100},1e3)},set_order:function(){return e.ajax({type:"POST",url:wc_checkout_params.checkout_url,data:t.checkout_form.serialize(),dataType:"json"}).fail((function(e,o,r){t.submit_error('<div class="woocommerce-error">'+r+"</div>")}))},create_order:function(){t.set_loading_on();var o={order_id:dokan_paypal.order_id,action:"dokan_paypal_create_order",nonce:dokan_paypal.nonce};return e.ajax({type:"POST",url:dokan_paypal.ajaxurl,data:o,dataType:"json"}).fail((function(e,o,r){t.set_loading_done(),t.submit_error('<div class="woocommerce-error">'+r+"</div>")}))},do_submit:function(){return t.set_loading_on(),dokan_paypal.is_checkout_pay_page?t.create_order():t.set_order()},capture_payment:function(r,a){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t.set_loading_on();var c={order_id:r,action:"dokan_paypal_capture_payment",nonce:dokan_paypal.nonce};e.ajax({type:"POST",url:dokan_paypal.ajaxurl,data:c,dataType:"json"}).done((function(e){t.set_loading_done();try{if(!e.success){if(e.data.data&&"INSTRUMENT_DECLINED"===JSON.parse(e.data.data[0]).details[0].issue)return n.restart();throw new Error(e.data.message)}o.location.href=a}catch(r){if(!0===e.reload)return void o.location.reload();e.data.message&&t.submit_error('<div class="woocommerce-error">'+e.data.message+"</div>")}})).fail((function(e,o,r){t.set_loading_done(),t.submit_error('<div class="woocommerce-error">'+r+"</div>")}))},render_ajax_response:function(e){try{if(dokan_paypal.is_checkout_pay_page&&(e=e.data.data),t.set_loading_done(),"success"===e.result)return t.order_success_redirect_url=e.success_redirect,t.order_cancel_redirect_url=e.cancel_redirect,t.order_id=e.id,e.paypal_order_id;throw"failure"===e.result?new Error("Result failure"):new Error("Invalid response")}catch(a){return!0===e.reload&&o.location.reload(),!0===e.refresh&&jQuery(r.body).trigger("update_checkout"),e.messages?t.submit_error(e.messages):t.submit_error('<div class="woocommerce-error">'+wc_checkout_params.i18n_checkout_error+"</div>"),!1}},init_hosted_fields:function(){dokan_paypal.is_ucc_enabled&&o.paypal.HostedFields.isEligible()&&o.paypal.HostedFields.render({createOrder:function(){return!!t.is_paypal_selected()&&t.do_submit().then((function(e){return t.render_ajax_response(e)}))},styles:{input:{"font-size":"17px","font-family":"helvetica, tahoma, calibri, sans-serif",color:"#3a3a3a"},":focus":{color:"black"}},fields:{number:{selector:"#dpm_card_number",placeholder:dokan_paypal.ucc_fields_placeholder.card_number},cvv:{selector:"#dpm_cvv",placeholder:dokan_paypal.ucc_fields_placeholder.cvv_number},expirationDate:{selector:"#dpm_card_expiry",placeholder:dokan_paypal.ucc_fields_placeholder.expiry_date}}}).then((function(o){var a;o.on("validityChange",(function(r){r.fields[r.emittedBy];var t=o.getState();(a=Object.keys(t.fields).every((function(e){return t.fields[e].isValid?t.fields[e].container.style.boxShadow="inset 2px 0 0 #0f834d":t.fields[e].container.style.boxShadow="inset 2px 0 0 #cc0000",t.fields[e].isValid})))?e("#pay_unbranded_order").attr("disabled",!1):e("#pay_unbranded_order").attr("disabled",!0)})),e("#pay_unbranded_order").on("click",(function(n){if(n.preventDefault(),e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),!a)return t.submit_error('<div class="woocommerce-error">'+dokan_paypal.card_info_error_message+"</div>"),!1;var c={};c=dokan_paypal.billing_address?dokan_paypal.billing_address:{streetAddress:r.getElementById("billing_address_1").value,extendedAddress:r.getElementById("billing_address_2").value,region:r.getElementById("billing_state").value,locality:r.getElementById("billing_city").value,postalCode:r.getElementById("billing_postcode").value,countryCodeAlpha2:r.getElementById("billing_country").value};var d={contingencies:["3D_SECURE"],cardholderName:r.getElementById("dpm_name_on_card").value,billingAddress:c};o.submit(d).then((function(e){t.capture_payment(t.order_id,t.order_success_redirect_url)})).catch((function(e){t.submit_error('<div class="woocommerce-error">'+e.message+"</div>")}))}))})).catch((function(e){t.submit_error('<div class="woocommerce-error">'+e.message+"</div>")}))},init_paypal:function(){o.paypal&&o.paypal.Buttons&&!t.loaded?(t.loaded=!0,o.paypal.Buttons({createOrder:function(e,o){return!!t.is_paypal_selected()&&t.do_submit().then((function(e){return t.render_ajax_response(e)}))},onApprove:function(e,o){t.capture_payment(t.order_id,t.order_success_redirect_url,o)},onCancel:function(e){t.set_loading_done(),t.reset_order_data()},onError:function(e){t.set_loading_done(),0===t.checkout_form.find(".woocommerce-NoticeGroup > ul.woocommerce-error, .woocommerce-NoticeGroup-checkout > ul.woocommerce-error").length&&t.submit_error('<div class="woocommerce-error">'+e+"</div>")}}).render("#paypal-button-container").catch((function(e){t.submit_error('<div class="woocommerce-error">'+JSON.stringify(e)+"</div>")})),t.init_hosted_fields(),e(".paypal-loader").hide()):t.loaded||setTimeout((function(){t.init_paypal()}),2e3)}};e(r).ready((function(){setTimeout((function(){a.init(),t.init_paypal()}),3e3)}))}}(jQuery,window,document);